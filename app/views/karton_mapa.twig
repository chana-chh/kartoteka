{% extends "templates/app.twig" %}

{% block sadrzaj %}
<h1 class="primary-text">
  Mapa kartona {{x_pozicija}} {{y_pozicija}}
  <span class="success-text"><small><em>[{{ karton.broj() }}]</em></small></span>
</h1>
<div class="well">
  <button onclick="window.history.back();">
    <i class="fas fa-angle-left"></i> Nazad
  </button>
  <a href="{{ path_for('kartoni') }}" class="btn"><i class="fas fa-angle-double-left"></i>Kartoni</a>
</div>

<div class="well white-text primary-bg">
  <div class="flex-row">
    <div class="flex-col">
      <strong>Groblje:</strong>
      {{ karton.groblje().naziv }}
    </div>
    <div class="flex-col">
      <strong>Parcela:</strong>
      {{ karton.parcela }}
    </div>
    <div class="flex-col">
      <strong>Grobno mesto:</strong>
      {{ karton.grobno_mesto }}
    </div>
    <div class="flex-col">
      <strong>Broj mesta:</strong>
      {{ karton.broj_mesta }}
    </div>
    <div class="flex-col">
      <strong>Tip groba:</strong>
      {{ karton.tip_groba }}
    </div>
    <div class="flex-col">
      <strong>Aktivan karton:</strong>
      {{ karton.aktivanDisabled() | raw }}
    </div>
  </div>
  <strong>Napomene:</strong><br />
  {{ karton.napomena | nl2br }}<br />
</div>
<div class="flex-row">
<div class="canvas">
<canvas id="canvas" width="1260" height="840" style="padding: 0; margin: auto; display: block;">
</canvas>
</div>
</div>
<script type="text/javascript">
var canvas = document.getElementById("canvas");
ctx = canvas.getContext("2d");
126
var mapa = ["{{mapa}}"];
canvas.width = 1260;
canvas.height = 840;

var background = new Image();
background.src = "../../img/Mape/"+mapa;

var x_osa = {{ karton.x_pozicija|json_encode() }};
var y_osa = {{ karton.y_pozicija|json_encode() }};
var g = ["{{ grobno_mesto}}"];

document.getElementById('canvas').onclick = function getCursorPosition(event){
    var rect = canvas.getBoundingClientRect();
    var x_zaBazu = parseInt(event.clientX - rect.left);
    var y_zaBazu = parseInt(event.clientY - rect.top);

    document.getElementById("x_pozicija").value = x_zaBazu;
    document.getElementById("y_pozicija").value = y_zaBazu;
}

background.onload = function(){
    ctx.drawImage(background,0,0);

    var radius = 5;
    var period = 2000;
    

        ctx.beginPath();
        ctx.arc(x_osa, y_osa, radius, 0, 2 * Math.PI, false);
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'red';
        ctx.stroke();
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.textAlign = "center";
        ctx.textBaseline="top";
        ctx.font = "14px Arial";
        ctx.fillText(g, x_osa, y_osa + 2*radius);
  };
</script>
{% endblock sadrzaj %}

{% block traka %}
<div class="flex-row" style="margin-top: 30px">
  <div class="flex-col-5">
    <h2 style="margin:0;">Koordinate</h2>
  </div>
</div>
<div class="well">
    <form action="{{ path_for('kartoni.mapa.dodavanje') }}" method="POST">
        {{ csrf|raw }}
        <div class="flex-row">
            <div class="flex-col-4">
                <input type="number" name="x_pozicija" id="x_pozicija" class="form-control" autocomplete="off" placeholder="X koordinata">
            </div>
            <div class="flex-col-4">
                <input type="number" name="y_pozicija" id="y_pozicija" class="form-control" autocomplete="off"
                    placeholder="Y koordinata">
            </div>
        </div>

        <input type="hidden" name="id_kartona" id="id_kartona" class="form-control" value="{{ karton.id }}">

        <div class="flex-row">
            <div class="flex-col-4">
                <input type="submit" value="Sačuvaj koordinate">
            </div>
            <div class="flex-col-1 right">
                <a href="{{ path_for('kartoni.mapa', { 'id': karton.id }) }}" class="btn">Otkaži</a>
            </div>
        </div>
        </div>
    </form>
</div>
{% endblock traka %}
